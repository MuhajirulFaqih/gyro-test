<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SOCAi 3D Tilt Alignment</title>

<style>
body{
  margin:0;
  background:#0f0f14;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
  font-family:sans-serif;
  color:white;
}

.container{
  position:relative;
  width:320px;
  height:320px;
  perspective:900px;
}

.target{
  position:absolute;
  width:180px;
  height:180px;
  border:3px solid white;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

.dynamic{
  position:absolute;
  width:180px;
  height:180px;
  border:3px solid #FF4D4D;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  transform-style:preserve-3d;
  backface-visibility:hidden;
}

button{
  margin-top:30px;
  padding:12px 20px;
}
</style>
</head>
<body>

<h3>SOCAi 3D Tilt Alignment</h3>

<div class="container">
  <div class="target"></div>
  <div class="dynamic" id="dynamicCircle"></div>
</div>

<div id="tiltValue">Tilt: 0°</div>
<button id="startBtn">Start</button>

<script>

const circle = document.getElementById("dynamicCircle");
const tiltValue = document.getElementById("tiltValue");
const btn = document.getElementById("startBtn");

let running = false;

let targetX = 0;
let targetY = 0;
let currentX = 0;
let currentY = 0;

let velocityX = 0;
let velocityY = 0;

const spring = 0.08;
const friction = 0.85;

function animate(){

  velocityX += (targetX - currentX) * spring;
  velocityY += (targetY - currentY) * spring;

  velocityX *= friction;
  velocityY *= friction;

  currentX += velocityX;
  currentY += velocityY;

  const distance = Math.sqrt(currentX*currentX + currentY*currentY);

  // Magnetic snap
  if(distance < 5){
    currentX *= 0.7;
    currentY *= 0.7;
  }

  const depthScale = 1 + (Math.abs(currentY) / 200);

  circle.style.transform =
    `translate(-50%, -50%)
     rotateX(${currentY * -0.6}deg)
     rotateY(${currentX * 0.6}deg)
     scale(${depthScale})`;

  circle.style.boxShadow =
    `${-currentX}px ${-currentY}px 40px rgba(255,0,0,0.25)`;

  const color = distance < 8 ? "#2BE38C" :
                distance < 20 ? "#FFC857" :
                "#FF4D4D";

  circle.style.borderColor = color;

  requestAnimationFrame(animate);
}

function handleOrientation(event){

  const gamma = event.gamma || 0;
  const beta  = event.beta  || 0;

  const sensitivity = 2.5;

  targetX = gamma * sensitivity;
  targetY = beta * sensitivity;

  const tiltMagnitude = Math.sqrt(gamma*gamma + beta*beta);
  tiltValue.innerText = "Tilt: " + tiltMagnitude.toFixed(1) + "°";
}

function start(){

  if(running){
    window.removeEventListener("deviceorientation", handleOrientation);
    btn.innerText = "Start";
    running = false;
    return;
  }

  if(typeof DeviceOrientationEvent !== "undefined" &&
     typeof DeviceOrientationEvent.requestPermission === "function"){

    DeviceOrientationEvent.requestPermission()
      .then(response=>{
        if(response === "granted"){
          window.addEventListener("deviceorientation", handleOrientation);
        }
      })
      .catch(console.error);

  }else{
    window.addEventListener("deviceorientation", handleOrientation);
  }

  btn.innerText = "Stop";
  running = true;
}

btn.addEventListener("click", start);

animate();

</script>

</body>
</html>
