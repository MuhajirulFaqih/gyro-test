<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Top View Gyro Guide</title>

<style>
body{
  margin:0;
  background:#0f0f14;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
  font-family:sans-serif;
  color:white;
}

.container{
  position:relative;
  width:320px;
  height:320px;
  perspective:1000px;
}

.target{
  position:absolute;
  width:180px;
  height:180px;
  border:3px solid white;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

.dynamic{
  position:absolute;
  width:180px;
  height:180px;
  border:3px solid #FF4D4D;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  transform-style:preserve-3d;
  backface-visibility:hidden;
  background: radial-gradient(circle at center,
              rgba(255,0,0,0.15),
              transparent 70%);
}

button{
  margin-top:20px;
  padding:12px 20px;
}

.status{
  margin-top:15px;
  font-size:14px;
  opacity:0.9;
}
</style>
</head>
<body>

<h3>SOCAi 3D Tilt + Depth</h3>

<div class="container">
  <div class="target"></div>
  <div class="dynamic" id="circle"></div>
</div>

<div class="status" id="statusText">
Tilt: 0째 | Depth: 0째 | Depth Score: 0%
</div>

<button id="startBtn">Start</button>

<script>

const circle = document.getElementById("circle");
const statusText = document.getElementById("statusText");
const btn = document.getElementById("startBtn");

let running = false;

let targetX = 0;
let targetY = 0;
let currentX = 0;
let currentY = 0;

let velocityX = 0;
let velocityY = 0;

const spring = 0.08;
const friction = 0.85;

function animate(){

  velocityX += (targetX - currentX) * spring;
  velocityY += (targetY - currentY) * spring;

  velocityX *= friction;
  velocityY *= friction;

  currentX += velocityX;
  currentY += velocityY;

  const distance = Math.sqrt(currentX*currentX + currentY*currentY);

  // Magnetic snap
  if(distance < 4){
    currentX *= 0.6;
    currentY *= 0.6;
  }

  // ----- DEPTH EFFECT -----
  const depthAmount = currentY * -2;
  const depthScale = 1 + Math.abs(currentY) / 180;
  const warpY = 1 - Math.abs(currentY) / 600;

  circle.style.transform =
    `
    translate(-50%, -50%)
    rotateX(${currentY * -0.7}deg)
    rotateY(${currentX * 0.7}deg)
    translateZ(${depthAmount}px)
    scale(${depthScale}, ${warpY})
    `;

  circle.style.boxShadow =
    `${-currentX}px ${-currentY}px 50px rgba(255,0,0,0.25)`;

  const color =
    distance < 6 ? "#2BE38C" :
    distance < 18 ? "#FFC857" :
    "#FF4D4D";

  circle.style.borderColor = color;

  requestAnimationFrame(animate);
}

function handleOrientation(event){

  const gamma = event.gamma || 0;  // left/right
  const beta  = event.beta  || 0;  // forward/back

  const sensitivity = 2.5;

  targetX = gamma * sensitivity;
  targetY = beta * sensitivity;

  const tiltMagnitude = Math.sqrt(gamma*gamma + beta*beta);
  const depthDegrees = Math.abs(beta);

  const depthScore = Math.min(depthDegrees / 45, 1) * 100;

  statusText.innerText =
    "Tilt: " + tiltMagnitude.toFixed(1) + "째" +
    " | Depth: " + depthDegrees.toFixed(1) + "째" +
    " | Depth Score: " + depthScore.toFixed(0) + "%";
}

function start(){

  if(running){
    window.removeEventListener("deviceorientation", handleOrientation);
    btn.innerText = "Start";
    running = false;
    return;
  }

  if(typeof DeviceOrientationEvent !== "undefined" &&
     typeof DeviceOrientationEvent.requestPermission === "function"){

    DeviceOrientationEvent.requestPermission()
      .then(response=>{
        if(response === "granted"){
          window.addEventListener("deviceorientation", handleOrientation);
        }
      })
      .catch(console.error);

  }else{
    window.addEventListener("deviceorientation", handleOrientation);
  }

  btn.innerText = "Stop";
  running = true;
}

btn.addEventListener("click", start);

animate();

</script>

</body>
</html>
